---
layout: post
title: java28
sitemap: false
hide_last_modified: true
---
# 동시성 제어 - 락

* toc
{:toc .large-only}

# 락

[자바 락](https://xxyoonxx.github.io/java/2024-06-20-java24/)

여러 스레드나 프로세스가 동일한 자원에 동시에 접근하는 것을 제어하는 메커니즘. 즉, 술집 화장실처럼 하나의 키로 한 칸의 화장실을 돌아가며 들어가는 것..(락=키)

# 분류

- 단일 노드 락: 단일 시스템 내에서 사용되는 락
- 분산 락: 여러 서버나 노드를 이용하는 분산 환경에서 사용되는 락

# 종류

## 자원 접근 제어에 따라
- 공유락(Shared lock): 다수의 읽기 트랜잭션은 허용하지만 쓰기 트랜잭션은 하나의 트랜잭션만 허용
- 배타락(Exclusive lock): 한번에 하나의 트랜잭션이 접근/작업이 가능하고 다른 트랜잭션은 이 작업중에는 접근하지 못함
- 스핀락(Spin lock): 락을 획득 할 때까지 계속 루프를 돌며 시도함. 대기시간이 짧을 경우 효율적

## 자원 접근 충돌 처리 방법에 따라
- 낙관적 락(Optimistic lock): 데이터 충돌이 없을 것이라 예상하고 락 없이 작업 후, 버전 관리 컬럼 값을 비교해 충돌 발생 시(초기 값과 다를 시) 해당 트랜잭션(늦게 실행된) 롤백 후 재시도한다.
- 비관적 락(Pessimistic lock): 데이터 충돌이 잦을 것이라 예상하고 데이터 사용 시마다 락을 건다. 다른 트랜잭션은 작업중인 트랜잭션이 락을 해제할때까지 대기한다.

두가지 방법 모두  설정에 따라 즉시 실패 처리(혹은 일정 횟수 재시도)도 가능하다.

## 메시지 전달
- Pub/Sub: `publisher`가 메시지를 발행하면 `broker` 를 통해 `subscriber` 가 이를 받는 방식

# 구현
위에 명시한 락(+외에 더 많이)들은 databaselock를 이용한 방법 뿐만 아니라 semaphore, 스택이나 큐를 이용한 알고리즘, 이벤트 기반 동기화 등 여러 방식을 사용하여 구현 가능하다.

# References

[공유락(Shared Lock) & 배타락(Exclusive Lock) - BFine](https://willbfine.tistory.com/578)
